# hw definition file for processing by chibios_pins.py
# for iFlight Beast H7 hardware.
# thanks to betaflight for pin information

# MCU class and specific type
MCU STM32F4xx STM32F405xx

HAL_CHIBIOS_ARCH_F405 1

# board ID for firmware load
APJ_BOARD_ID 128

# crystal frequency, setup to use external oscillator
OSCILLATOR_HZ 8000000

STM32_ST_USE_TIMER 5

# flash size
FLASH_SIZE_KB 1024
FLASH_RESERVE_START_KB 64


#adc
PC1 BAT_CURR_SENS ADC1 SCALE(1)
#pwm output
PB0 TIM3_CH3 TIM3 PWM(1) GPIO(50)
PB1 TIM3_CH4 TIM3 PWM(2) GPIO(51)
PB4 TIM3_CH1 TIM3 PWM(3) GPIO(52)
PA15 TIM2_CH1 TIM2 PWM(4) GPIO(53)


PA4 MAG_CS CS
PC4 ICM2062_CS CS
PC5 BARO_CS CS
PA5 SPI1_SCK SPI1
PA6 SPI1_MISO SPI1
PA7 SPI1_MOSI SPI1

PB12 FLASH_CS CS
PC3 SPI2_MOSI SPI2
PC2 SPI2_MISO SPI2
PB13 SPI2_SCK SPI2

# order of UARTs
SERIAL_ORDER OTG1 USART1 

PA10 USART1_RX USART1
PA9 USART1_TX USART1

PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1

PC7 TIM8_CH2 TIM8 RCIN PULLUP LOW DMA_CH0 

# one IMU
SPIDEV icm20602 SPI1 DEVID1 ICM2062_CS  MODE3   2*MHZ   8*MHZ
SPIDEV spl06    SPI1 DEVID2 BARO_CS     MODE3   2*MHZ   8*MHZ
SPIDEV mmc5983  SPI1 DEVID3 MAG_CS      MODE3   2*MHZ   8*MHZ

SPIDEV dataflash  SPI2 DEVID1 FLASH_CS MODE3 32*MHZ 32*MHZ

IMU Invensense SPI:icm20602 ROTATION_ROLL_180_YAW_270
define HAL_DEFAULT_INS_FAST_SAMPLE 1

BARO SPL06 SPI:spl06

COMPASS MMC5983 SPI:mmc5983 ROTATION_ROLL_180
define HAL_PROBE_EXTERNAL_I2C_COMPASSES

define HAL_STORAGE_SIZE 15360
define STORAGE_FLASH_PAGE 1
# enable logging to dataflash
define HAL_LOGGING_DATAFLASH
# reserve 32k for bootloader and 32k for flash storage
FLASH_RESERVE_START_KB 64



define BOARD_PWM_COUNT_DEFAULT 4